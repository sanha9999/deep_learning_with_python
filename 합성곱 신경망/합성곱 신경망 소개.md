# 합성곱 신경망 소개
------------------------------
> #### 컨브넷이 (image_height, image_width, image_channels) 크기의 입력 텐서를 사용한다는 점이 중요하다(배치차원 미포함). 이 때문에 input_shape에 28, 28, 1(1은 회색을 의미하는듯..)을 넣었구만.
-----------------------------
> ### 합성곱 연산
> #### 완전 연결층과 합성곱 층 사이의 근본적인 차이는 무엇일까? 바로 Dense 층은 입력 특성 공간에 있는 전역 패턴을(예를 들어 MNIST 숫자 이미지에서는 모든 픽셀에 걸친 패턴)을 학습하지만 합성곱 층은 지역 패턴을 학습한다는 것에서 차이가 있다.
> #### 이 핵심 특징은 컨브넷에 두가지 재밌는 성질을 제공한다!!
* **학습된 패턴은 평행 이동 불변성을 가진다.**
> 컨브넷이 이미지의 오른쪽 아래 모서리에서 어떤 패턴을 학습했다면 다른 곳 에서도 이 패턴을 인식할 수 있다. 완전 연결 네트워크는 새로운 위치에 나타난 것은 새로운 패턴으로 학습해야 한다. 이런 성질은 컨브넷이 이미지를 효율적으로 처리하게 해준다!!
* **컨브넷은 패턴의 공간적 계층 구조를 학습 할 수 있다**
> 첫 번째 합성곱 층이 에지 같은 작은 지역 패턴을 학습한다. 두 번째 합성곱 층은 첫 번째 특성으로 구성된 더 큰 패턴을 학습한다. 이런 방식을 사용하여 컨브넷은 아주 복잡하고 추상적인 시각적 개념을 효과적으로 학습할 수 있다.
> #### 합성곱 연산은 특성 맵이라고 부르는 3D텐서에 적용된다. 이 텐서는 높이와 넓이, 깊이 축(채널이라고도 부름)으로 구성된다. RGB이미지는 깊이 축의 차원이 3이된다. 합성곱 연산은 입력 특성 맵에서 작은 패치들을 추출하고 이런 모든 패치에 같은 변환을 적용하여 출력 특성 맵을 만든다.
--------------------------------------------------
> ### 출력 특성맵
> 출력 특성맵도 높이와 넓이를 가진 3D텐서이다. 출력 텐서의 깊이는 층의 매개변수로 결정되기 때문에 상황에 따라 다르다. 이렇게 되면 깊이 축의 채널은 필터(합성곱 층에서 사용하는 모델 파라미터)를 의미하게 된다. 필터는 입력 데이터의 어떤 특성을 인코딩하는데, 예를 들어 고수준으로 보면 하나의 필터가 '입력에 얼굴이 있는지'를 인코딩할 수 있다. 
> MNIST 예제에서 살펴보면 ``` model.add(layers.Conv2D(32, (3, 3), activation='relu', input_shape=(28,28,1))) ``` 에서 첫번째 합성곱 층이 (28, 28, 1) 크기의 특성맵을 입력으로 받아 (26, 26, 32)의 크기의 특성 맵을 출력한다. 즉 입력에 대해 32개의 필터를 적용한다는 것이다(필터 하나의 크기는 patch_height, patch_width, input_depth 이다). 32개의 출력 채널 각각은 26 * 26 의 값을 가진다. 이 값은 입력에 대한 필터의 응답 맵이라고 한다. 그래서 특성맵이란 말이 의미하는 것은 깊이 축에 있는 각 차원은 하나의 특성이고, 2D텐서 output[:, : , n]은 입력에 대한 필터 응답을 나타내는 2D공간상의 맵이다. 
> #### 그래서 합성곱은 핵심적인 2개의 파라미터로 정의된다.
* **입력으로부터 뽑아낼 패치의 크기**
> 전형적으로 3 * 3 또는 5 * 5를 사용한다. 우리의 예시에서는 3 * 3을 사용했다.
* **특성 맵의 출력 깊이**
> 합성곱으로 계산할 필터의 수이다. 우리의 예시에서는 깊이 32로 시작해서 깊이 64로 끝났다.
> #### 케라스의 Conv2D 층에서 이 파라미터는 Conv2D(output_depth, (window_height, window_width))처럼 첫번째와 두번째 매개변수로 전달된다.
-----------------------------------------------------
> ### 합성곱 작동 방식
> 3D입력 특성 맵 위를 3 * 3 또는 5 * 5크기의 윈도우가 슬라이딩하면서 모든 위치에서 3D 특성 패치를 추출하는 방식으로 합성곱이 작동한다. 이런 3D패치는 (output_depth,)크기의 1D벡터로 변환된다(합성곱 커널이라고 불리는 하나의 학습된 가중치 행렬과 텐서곱셈을 통하여 변환된다). 변환된 모든 벡터는 (height, width, output_depth) 크기의 3D 특성 맵으로 재구성 된다. 출력 특성맵의 공간상 위치는 입력 특성 맵의 같은 위치에 대응된다. 
> #### 출력 높이와 너비는 입력의 높이, 너비와 다를 수 있는데 두가지 이유가 있다.
* **경계문제, 입력특성맵에 패딩을 추가하여 대응할 수 있다.**
* **스트라이드(stride)의 사용 여부에 따라 다르다.**
